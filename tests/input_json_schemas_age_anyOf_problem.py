# made-up schema - collection of columns with anyOf





test_schema_collection_anyOf_problem_column_short_version_2_columns =  """{ "type": "SCHEMA", "stream": "nested_stream", "schema": { "properties": 

{ 


    "note_attributes": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "name": {                      "type": [                        "null",                        "string"                      ]                    },                    "value": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          },



     "simplification_stage_adds_anyOf": { "type": [ "null", "integer", "string" ] }
    
}, "type": [ "null", "object" ] }, "key_properties": [ "campaign_id", "adset_id", "ad_id", "date_start", "age", "gender" ], "bookmark_properties": [ "date_start" ] }"""




test_schema_collection_anyOf_problem_column_short_version =  """{ "type": "SCHEMA", "stream": "nested_stream", "schema": { "properties": 

{ 

     "simplification_stage_adds_anyOf": { "type": [ "null", "integer", "string" ] }
    
}, "type": [ "null", "object" ] }, "key_properties": [ "campaign_id", "adset_id", "ad_id", "date_start", "age", "gender" ], "bookmark_properties": [ "date_start" ] }"""





test_schema_collection_anyOf_problem_column =  """{ "type": "SCHEMA", "stream": "nested_stream", "schema": { "properties": 

{ 
  

    "test_column_no_anyOf": { "items": { "properties": { "action_destination": { "type": [ "null", "string" ] }, "action_target_id": { "type": [ "null", "string" ] }, "action_type": { "type": [ "null", "string" ] }, "value": { "type": [ "null", "number" ] } }, "type": [ "null", "object" ] }, "type": [ "null", "array" ] },


    "BiddingScheme": {"anyOf": [{"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "InheritedBidStrategyType": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}, "TargetCpa": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "TargetRoas": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}, "TargetRoas": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}, "TargetAdPosition": {"type": ["null", "string"]}, "TargetImpressionShare": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}]}, 

    "Settings": {"type": ["null", "object"], "properties": {"Setting": {"type": ["null", "array"], "items": {"anyOf": [{"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "Details": {"type": ["null", "object"], "properties": {"TargetSettingDetail": {"type": ["null", "array"], "items": {"type": ["null", "object"], "additionalProperties": false, "properties": {"CriterionTypeGroup": {"type": ["null", "string"]}, "TargetAndBid": {"type": ["boolean"]}}}}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "LocalInventoryAdsEnabled": {"type": ["null", "boolean"]}, "Priority": {"type": ["null", "integer"]}, "SalesCountryCode": {"type": ["null", "string"]}, "StoreId": {"type": ["null", "integer"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "BidBoostValue": {"type": ["null", "number"]}, "BidMaxValue": {"type": ["null", "number"]}, "BidOption": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "DomainName": {"type": ["null", "string"]}, "Language": {"type": ["null", "string"]}, "PageFeedIds": {"type": ["null", "object"], "properties": {"long": {"type": ["null", "array"], "items": {"type": "integer"}}}}, "Source": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}]}}}}, 


    "discount_codes": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "amount": {                      "type": [                        "null",                        "number"                      ]                    },                    "code": {                      "type": [                        "null",                        "string"                      ]                    },                    "type": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }, 



    "line_items": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "grams": {                      "type": [                        "null",                        "integer"                      ]                    },                    "images": {                      "type": [                        "null",                        "object"                      ],                      "additionalProperties": false,                      "properties": {                        "large": {                          "type": [                            "null",                            "string"                          ]                        },                        "medium": {                          "type": [                            "null",                            "string"                          ]                        },                        "original": {                          "type": [                            "null",                            "string"                          ]                        },                        "small": {                          "type": [                            "null",                            "string"                          ]                        }                      }                    },                    "price": {                      "type": [                        "null",                        "number"                      ],                      "multipleOf": 1e-08                    },                    "properties": {                      "anyOf": [                        {                          "type": "array",                          "items": {                            "type": "object",                            "additionalProperties": false,                            "properties": {                              "name": {                                "type": [                                  "null",                                  "string"                                ]                              },                              "value": {                                "type": [                                  "null",                                  "string"                                ]                              }                            }                          }                        },                        {                          "type": "null"                        }                      ]                    },                    "quantity": {                      "type": [                        "null",                        "integer"                      ]                    },                    "shopify_product_id": {                      "type": [                        "null",                        "string"                      ]                    },                    "shopify_variant_id": {                      "type": [                        "null",                        "string"                      ]                    },                    "sku": {                      "type": [                        "null",                        "string"                      ]                    },                    "subscription_id": {                      "type": [                        "null",                        "string"                      ]                    },                    "title": {                      "type": [                        "null",                        "string"                      ]                    },                    "variant_title": {                      "type": [                        "null",                        "string"                      ]                    },                    "vendor": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }, 



    "shipping_lines": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "code": {                      "type": [                        "null",                        "string"                      ]                    },                    "price": {                      "type": [                        "null",                        "number"                      ]                    },                    "title": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }, 


    "tax_lines": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "code": {                      "type": [                        "null",                        "string"                      ]                    },                    "price": {                      "type": [                        "null",                        "number"                      ]                    },                    "title": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          },


    "note_attributes": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "name": {                      "type": [                        "null",                        "string"                      ]                    },                    "value": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          },

    "simplification_stage_adds_anyOf": { "type": [ "null", "integer", "string" ] }

   

    
}, "type": [ "null", "object" ] }, "key_properties": [ "campaign_id", "adset_id", "ad_id", "date_start", "age", "gender" ], "bookmark_properties": [ "date_start" ] }"""






test_schema_collection_anyOf_problem_column_removed =  """{ "type": "SCHEMA", "stream": "nested_stream", "schema": { "properties": 

{ 
    
    "test_column_no_anyOf": { "items": { "properties": { "action_destination": { "type": [ "null", "string" ] }, "action_target_id": { "type": [ "null", "string" ] }, "action_type": { "type": [ "null", "string" ] }, "value": { "type": [ "null", "number" ] } }, "type": [ "null", "object" ] }, "type": [ "null", "array" ] },


    "BiddingScheme": {"anyOf": [{"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "InheritedBidStrategyType": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}, "TargetCpa": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "TargetRoas": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}, "TargetRoas": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "MaxCpc": {"type": ["null", "object"], "additionalProperties": false, "properties": {"Amount": {"type": ["null", "number"]}}}, "TargetAdPosition": {"type": ["null", "string"]}, "TargetImpressionShare": {"type": ["null", "number"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}]}, 

    "Settings": {"type": ["null", "object"], "properties": {"Setting": {"type": ["null", "array"], "items": {"anyOf": [{"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "Details": {"type": ["null", "object"], "properties": {"TargetSettingDetail": {"type": ["null", "array"], "items": {"type": ["null", "object"], "additionalProperties": false, "properties": {"CriterionTypeGroup": {"type": ["null", "string"]}, "TargetAndBid": {"type": ["boolean"]}}}}}}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "LocalInventoryAdsEnabled": {"type": ["null", "boolean"]}, "Priority": {"type": ["null", "integer"]}, "SalesCountryCode": {"type": ["null", "string"]}, "StoreId": {"type": ["null", "integer"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "BidBoostValue": {"type": ["null", "number"]}, "BidMaxValue": {"type": ["null", "number"]}, "BidOption": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}, "DomainName": {"type": ["null", "string"]}, "Language": {"type": ["null", "string"]}, "PageFeedIds": {"type": ["null", "object"], "properties": {"long": {"type": ["null", "array"], "items": {"type": "integer"}}}}, "Source": {"type": ["null", "string"]}}}, {"type": ["null", "object"], "additionalProperties": false, "properties": {"Type": {"type": ["null", "string"]}}}]}}}}, 


    "discount_codes": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "amount": {                      "type": [                        "null",                        "number"                      ]                    },                    "code": {                      "type": [                        "null",                        "string"                      ]                    },                    "type": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }, 



    "line_items": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "grams": {                      "type": [                        "null",                        "integer"                      ]                    },                    "images": {                      "type": [                        "null",                        "object"                      ],                      "additionalProperties": false,                      "properties": {                        "large": {                          "type": [                            "null",                            "string"                          ]                        },                        "medium": {                          "type": [                            "null",                            "string"                          ]                        },                        "original": {                          "type": [                            "null",                            "string"                          ]                        },                        "small": {                          "type": [                            "null",                            "string"                          ]                        }                      }                    },                    "price": {                      "type": [                        "null",                        "number"                      ],                      "multipleOf": 1e-08                    },                    "properties": {                      "anyOf": [                        {                          "type": "array",                          "items": {                            "type": "object",                            "additionalProperties": false,                            "properties": {                              "name": {                                "type": [                                  "null",                                  "string"                                ]                              },                              "value": {                                "type": [                                  "null",                                  "string"                                ]                              }                            }                          }                        },                        {                          "type": "null"                        }                      ]                    },                    "quantity": {                      "type": [                        "null",                        "integer"                      ]                    },                    "shopify_product_id": {                      "type": [                        "null",                        "string"                      ]                    },                    "shopify_variant_id": {                      "type": [                        "null",                        "string"                      ]                    },                    "sku": {                      "type": [                        "null",                        "string"                      ]                    },                    "subscription_id": {                      "type": [                        "null",                        "string"                      ]                    },                    "title": {                      "type": [                        "null",                        "string"                      ]                    },                    "variant_title": {                      "type": [                        "null",                        "string"                      ]                    },                    "vendor": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }, 



    "shipping_lines": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "code": {                      "type": [                        "null",                        "string"                      ]                    },                    "price": {                      "type": [                        "null",                        "number"                      ]                    },                    "title": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }, 


    "tax_lines": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "code": {                      "type": [                        "null",                        "string"                      ]                    },                    "price": {                      "type": [                        "null",                        "number"                      ]                    },                    "title": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          },


    "note_attributes": {            "anyOf": [              {                "type": "array",                "items": {                  "type": "object",                  "additionalProperties": false,                  "properties": {                    "name": {                      "type": [                        "null",                        "string"                      ]                    },                    "value": {                      "type": [                        "null",                        "string"                      ]                    }                  }                }              },              {                "type": "null"              }            ]          }

    
}, "type": [ "null", "object" ] }, "key_properties": [ "campaign_id", "adset_id", "ad_id", "date_start", "age", "gender" ], "bookmark_properties": [ "date_start" ] }"""




# age column creates an issue: simplification stage adds anyOf, which then fails the conversion stage
problem_schema_age_anyOf =  '{ "type": "SCHEMA", "stream": "nested_stream", "schema": { "properties": { "age": { "type": [ "null", "integer", "string" ] }, "website_ctr": { "items": { "properties": { "action_destination": { "type": [ "null", "string" ] }, "action_target_id": { "type": [ "null", "string" ] }, "action_type": { "type": [ "null", "string" ] }, "value": { "type": [ "null", "number" ] } }, "type": [ "null", "object" ] }, "type": [ "null", "array" ] } }, "type": [ "null", "object" ] }, "key_properties": [ "campaign_id", "adset_id", "ad_id", "date_start", "age", "gender" ], "bookmark_properties": [ "date_start" ] }'


# age colummn removed - unit test succeeds
problem_schema_age_anyOf_removed =  '{ "type": "SCHEMA", "stream": "nested_stream", "schema": { "properties": {"website_ctr": { "items": { "properties": { "action_destination": { "type": [ "null", "string" ] }, "action_target_id": { "type": [ "null", "string" ] }, "action_type": { "type": [ "null", "string" ] }, "value": { "type": [ "null", "number" ] } }, "type": [ "null", "object" ] }, "type": [ "null", "array" ] } }, "type": [ "null", "object" ] }, "key_properties": [ "campaign_id", "adset_id", "ad_id", "date_start", "age", "gender" ], "bookmark_properties": [ "date_start" ] }'




